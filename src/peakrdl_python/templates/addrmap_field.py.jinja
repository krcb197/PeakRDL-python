{#
peakrdl-python is a tool to generate Python Register Access Layer (RAL) from SystemRDL
Copyright (C) 2021 - 2023

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.
#}
{% include "header.py.jinja" with context %}

from {% if skip_lib_copy %}peakrdl_python.{% else %}....{% endif %}lib import UDPStruct
{% if asyncoutput -%}
from {% if skip_lib_copy %}peakrdl_python.{% else %}....{% endif %}lib import FieldAsyncReadOnly, FieldAsyncWriteOnly, FieldAsyncReadWrite, Field
{% if uses_enum %}from {% if skip_lib_copy %}peakrdl_python.{% else %}....{% endif %}lib import FieldEnumAsyncReadOnly, FieldEnumAsyncWriteOnly, FieldEnumAsyncReadWrite{% endif %}
{%- else -%}
from {% if skip_lib_copy %}peakrdl_python.{% else %}....{% endif %}lib import FieldReadOnly, FieldWriteOnly, FieldReadWrite, Field
{% if uses_enum %}from {% if skip_lib_copy %}peakrdl_python.{% else %}....{% endif %}lib import FieldEnumReadOnly, FieldEnumWriteOnly, FieldEnumReadWrite{% endif %}
{%- endif %}

{% from 'addrmap_udp_property.py.jinja' import udp_property with context %}
{% from 'addrmap_universal_property.py.jinja' import universal_properties with context %}

{% for property_enum in unique_property_enums %}
from ...{{top_node.inst_name}}_property_enums import {{property_enum.type_name}}_property_enumcls
{% endfor %}

{%- macro field_class(node) %}
class {{node.python_class_name}}({{node.base_class(asyncoutput)}}):
    """
    Class to represent a register field in the register model

    {{get_table_block(node.instance) | indent}}
    """
    __slots__ : list[str] = []

    {{ udp_property(node) }}

    {{ universal_properties(node.instance) }}

{%- endmacro -%}

# field definitions
{%- for unique_node in unique_fields -%}
{# the get_dependent_component already strips out hidden items so there is no need to check here
   for hidden items #}
    {% if isinstance(unique_node.instance, systemrdlFieldNode) %}
    {{ field_class(unique_node)  }}
    {% else %}
    {{ raise_template_error('Encountered unhandled type') }}
    {% endif %}
{% endfor %}

if __name__ == '__main__':
    pass
