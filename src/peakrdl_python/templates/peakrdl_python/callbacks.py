"""
This module is intended to distributed as part of automatically generated code by the PeakRDL
Python tool. It provides a set of types used by the autogenerated code to callbacks
"""
import sys

from array import array as Array

from typing import Optional, Union

if sys.version_info >= (3, 8):
    # Python 3.8 introduced the Protocol class to the typing module which is more powerful than the
    # previous method because it also check the argument names

    from typing import Protocol

    class ReadCallback(Protocol):
        """
        Callback definition for a single register read operation
        """
        # pylint: disable=too-few-public-methods
        def __call__(self, addr: int, width: int, accesswidth: int) -> int:
            pass


    class WriteCallback(Protocol):
        """
        Callback definition for a single register write operation
        """
        # pylint: disable=too-few-public-methods
        def __call__(self, addr: int, width: int, accesswidth: int, data: int) -> None:
            pass


    class ReadBlockCallback(Protocol):
        """
        Callback definition for a block read operation
        """
        # pylint: disable=too-few-public-methods
        def __call__(self, addr: int, width: int, accesswidth: int, length: int) -> Array:
            pass


    class WriteBlockCallback(Protocol):
        """
        Callback definition for a block write operation
        """
        # pylint: disable=too-few-public-methods
        def __call__(self, addr: int, width: int, accesswidth: int, data: Array) -> None:
            pass


    class AsyncReadCallback(Protocol):
        """
        Callback definition for a single register async read operation
        """
        # pylint: disable=too-few-public-methods
        def __await__(self, addr: int, width: int, accesswidth: int) -> int:
            pass


    class AsyncWriteCallback(Protocol):
        """
        Callback definition for a single register async write operation
        """
        # pylint: disable=too-few-public-methods
        def __await__(self, addr: int, width: int, accesswidth: int, data: int) -> None:
            pass


    class AsyncReadBlockCallback(Protocol):
        """
        Callback definition for an async block read operation
        """
        # pylint: disable=too-few-public-methods
        def __await__(self, addr: int, width: int, accesswidth: int, length: int) -> Array:
            pass


    class AsyncWriteBlockCallback(Protocol):
        """
        Callback definition for an async block write operation
        """
        # pylint: disable=too-few-public-methods
        def __await__(self, addr: int, width: int, accesswidth: int, data: Array) -> None:
            pass
else:
    from typing import Callable, Coroutine

    ReadCallback = Callable[[int, int, int], int]
    WriteCallback = Callable[[int, int, int, int], None]
    ReadBlockCallback = Callable[[int, int, int, int], Array]
    WriteBlockCallback = Callable[[int, int, int, Array], None]
    AsyncReadCallback = Callable[[int, int, int], Coroutine[None, None, int]]
    AsyncWriteCallback = Callable[[int, int, int, int], Coroutine[None, None, None]]
    AsyncReadBlockCallback = Callable[[int, int, int, int], Coroutine[None, None, Array]]
    AsyncWriteBlockCallback = Callable[[int, int, int, Array], Coroutine[None, None, None]]

WriteCallbackOrAsync = Union[WriteCallback, AsyncWriteCallback]
ReadCallbackOrAsync = Union[ReadCallback, AsyncReadCallback]
WriteBlockCallbackOrAsync = Union[WriteBlockCallback, AsyncWriteBlockCallback]
ReadBlockCallbackOrAsync = Union[ReadBlockCallback, AsyncReadBlockCallback]

class CallbackSet:
    """
    Class to hold a set of callbacks, this reduces the number of callback that need to be passed
    around
    """

    __slots__ = ['__write_callback', '__read_callback',
                 '__write_block_callback', '__read_block_callback']

    def __init__(self,
                 write_callback: Optional[WriteCallbackOrAsync] = None,
                 read_callback: Optional[ReadCallbackOrAsync] = None,
                 write_block_callback: Optional[WriteBlockCallbackOrAsync] = None,
                 read_block_callback: Optional[ReadBlockCallbackOrAsync] = None):

        self.__read_callback = read_callback
        self.__read_block_callback = read_block_callback
        self.__write_callback = write_callback
        self.__write_block_callback = write_block_callback

    @property
    def read_callback(self) -> Optional[ReadCallbackOrAsync]:
        """
        single read callback function

        Returns: call back function

        """
        return self.__read_callback

    @property
    def write_callback(self) -> Optional[WriteCallbackOrAsync]:
        """
        single write callback function

        Returns: call back function

        """
        return self.__write_callback

    @property
    def read_block_callback(self) -> Optional[ReadBlockCallbackOrAsync]:
        """
        block read callback function

        Returns: call back function

        """
        return self.__read_block_callback

    @property
    def write_block_callback(self) -> Optional[WriteBlockCallbackOrAsync]:
        """
        block read callback function

        Returns: call back function

        """
        return self.__write_block_callback
